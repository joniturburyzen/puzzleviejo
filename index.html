<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>El Ciclo del Aprendiz</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #0a0a0a;
      color: #f8f9fa;
      height: 100vh;
      overflow: hidden;
      touch-action: manipulation;
    }
    #game-container {
      position: relative;
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      text-align: center;
      transition: background 1.5s ease;
    }
    .room-1 { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); }
    .room-2 { background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%); }
    .room-3 { background: linear-gradient(135deg, #1a2a6c 0%, #2c3e50 100%); }
    .room-4 { background: linear-gradient(135deg, #2c3e50 0%, #8e44ad 100%); }
    .room-5 { background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%); }
    .room-6 { background: linear-gradient(135deg, #3498db 0%, #16a085 100%); }
    .room-7 { background: linear-gradient(135deg, #16a085 0%, #2c3e50 100%); }
    .room-8 { background: linear-gradient(135deg, #2c3e50 0%, #1a1a2e 100%); }
    .room-final { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
    #character {
      font-size: 64px;
      margin: 20px 0;
      transition: transform 1.2s ease, opacity 1.2s ease;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
      animation: pulse 3s infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    #character.small { transform: scale(0.7); }
    #character.medium { transform: scale(0.9); }
    #character.large { transform: scale(1.1); }
    #character.xlarge { transform: scale(1.3); }
    #character.elder { transform: scale(1.2) rotate(-5deg); opacity: 0.9; }
    #narrative {
      background: rgba(0, 0, 0, 0.7);
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
      max-width: 90%;
      font-size: 18px;
      line-height: 1.6;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 215, 0, 0.3);
    }
    #narrative h2 {
      color: #ffd700;
      margin-bottom: 15px;
      font-size: 24px;
    }
    #narrative p {
      margin: 10px 0;
      color: #e0e0e0;
    }
    #puzzle-container {
      background: rgba(20, 20, 30, 0.9);
      border-radius: 20px;
      padding: 30px;
      width: 95%;
      max-width: 500px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
      border: 3px solid rgba(255, 215, 0, 0.4);
    }
    .puzzle-title {
      color: #ffd700;
      font-size: 22px;
      margin-bottom: 20px;
      font-weight: bold;
    }
    input[type="text"], textarea {
      width: 100%;
      padding: 15px;
      margin: 15px 0;
      border: 2px solid #ffd700;
      border-radius: 10px;
      background: rgba(30, 30, 40, 0.9);
      color: #ffd700;
      font-size: 18px;
      text-align: center;
    }
    input[type="text"]::placeholder, textarea::placeholder {
      color: rgba(255, 215, 0, 0.5);
    }
    button {
      background: linear-gradient(135deg, #ffd700 0%, #ff6b6b 100%);
      color: #1a1a2e;
      border: none;
      padding: 15px 40px;
      margin: 10px 5px;
      border-radius: 50px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
    }
    button:active {
      transform: translateY(1px);
    }
    button.secondary {
      background: rgba(255, 255, 255, 0.2);
      color: #ffd700;
      border: 2px solid #ffd700;
    }
    .hint {
      background: rgba(255, 215, 0, 0.1);
      border-left: 4px solid #ffd700;
      padding: 15px;
      margin: 20px 0;
      border-radius: 0 10px 10px 0;
      text-align: left;
      font-style: italic;
      color: #ffd700;
      display: none; /* OCULTAMOS TODAS LAS PISTAS POR DEFECTO */
    }
    .hint-title {
      color: #ff6b6b;
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    .success {
      color: #00ff9d;
      font-weight: bold;
      margin: 15px 0;
      font-size: 20px;
      animation: fadeIn 0.5s;
    }
    .error {
      color: #ff6b6b;
      font-weight: bold;
      margin: 15px 0;
      font-size: 18px;
      animation: shake 0.5s;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes shake { 
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    #orientation-door {
      font-size: 80px;
      margin: 20px 0;
      display: inline-block;
      transform: rotate(90deg); /* PUERTA GIRADA VERTICALMENTE */
      transition: transform 0.3s ease;
    }
    @media (orientation: landscape) {
      #portrait-instruction { display: none !important; }
      #landscape-instruction { display: block !important; }
      #orientation-door { transform: rotate(0deg) !important; }
    }
    #portrait-instruction, #landscape-instruction {
      margin: 20px 0;
      font-size: 20px;
      font-weight: bold;
    }
    #mic-container {
      text-align: center;
      margin: 20px 0;
    }
    #mic-visualizer {
      width: 100%;
      height: 100px;
      background: rgba(30, 30, 40, 0.8);
      border-radius: 15px;
      margin: 20px 0;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      overflow: hidden;
      border: 2px solid #ffd700;
    }
    .mic-bar {
      width: 15px;
      height: 5px;
      background: #ffd700;
      margin: 0 2px;
      border-radius: 5px;
      transition: height 0.05s ease;
    }
    .hidden-text {
      color: rgba(255, 255, 255, 0.98); /* BLANCO CASI PURO */
      background: rgba(255, 255, 255, 0.98);
      padding: 8px 15px;
      border-radius: 8px;
      margin: 25px 0;
      font-size: 18px;
      user-select: all;
      -webkit-user-select: all;
      cursor: default; /* SIN CURSOR DE SELECCI√ìN OBVIO */
      letter-spacing: 2px; /* M√ÅS DISCRETO */
    }
    #final-text {
      font-size: 24px;
      line-height: 1.8;
      color: #ffd700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
      margin: 40px 0;
      padding: 30px;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 20px;
      border: 3px solid #ffd700;
    }
    #progress-bar {
      position: fixed;
      top: 0;
      left: 0;
      height: 8px;
      background: rgba(255, 215, 0, 0.3);
      z-index: 1000;
      transition: width 0.5s ease;
    }
    @media (max-width: 480px) {
      #character { font-size: 50px; }
      #narrative { font-size: 16px; padding: 20px; }
      input[type="text"], textarea { padding: 12px; font-size: 16px; }
      button { padding: 12px 30px; font-size: 16px; }
    }
  </style>
</head>
<body>
  <div id="progress-bar"></div>
  <div id="game-container" class="room-1">
    <div id="character" class="small">üë∂</div>
    <div id="narrative">
      <h2>üå± Sala 1: El Jard√≠n de los Secretos</h2>
      <p><em>"Peque√±a semilla... los secretos no se esconden. Solo esperan a que aprendas a mirar sin ver."</em></p>
    </div>
    <div id="puzzle-container">
      <div class="puzzle-title">El Espejo Roto</div>
      <div class="hidden-text">LIBERTAD</div>
      <input type="text" id="clipboard-input" placeholder="¬øQu√© ves?" autocomplete="off">
      <button id="submit-1">Confirmar</button>
      <div class="hint">
        <span class="hint-title">Reflexi√≥n:</span>
        A veces lo que buscas est√° frente a ti... pero necesitas mirar desde dentro.
      </div>
      <div id="feedback-1"></div>
    </div>
  </div>

  <script>
    const gameState = {
      currentRoom: 1,
      characterStage: 1,
      solved: [false, false, false, false, false, false, false, false],
      characterEmojis: ['üë∂', 'üë¶', 'üßí', 'üßë', 'üë®', 'üßî', 'üë¥', 'üßì', 'üë∂'],
      characterClasses: ['small', 'medium', 'medium', 'large', 'large', 'xlarge', 'xlarge', 'elder', 'small'],
      roomClasses: ['room-1', 'room-2', 'room-3', 'room-4', 'room-5', 'room-6', 'room-7', 'room-8', 'room-final'],
      narratives: [
        { title: 'üå± Sala 1: El Jard√≠n de los Secretos', text: '"Peque√±a semilla... los secretos no se esconden. Solo esperan a que aprendas a mirar sin ver."' },
        { title: 'üß© Sala 2: El Pasillo de los Espejos', text: '"Brote que pregunta... ¬øqui√©n es el √∫nico lazo que el tiempo no puede romper?"' },
        { title: 'üö™ Sala 3: El Espejo Digital', text: '"Tallo que busca el sol... mi mundo est√° torcido. Endereza tu realidad para encontrar el camino."' },
        { title: '‚è∞ Sala 4: La Torre del Tiempo', text: '"Rama que se dobla al viento... el tiempo es un c√≠rculo roto. Encuentra el punto donde ayer y ma√±ana se tocan."' },
        { title: 'üí® Sala 5: El Valle del Aliento', text: '"√Årbol que sostiene su primer fruto... a veces lo que falta no es fuerza. Es aliento."' },
        { title: 'üßµ Sala 6: El Telar de los D√≠as', text: '"Tronco que carga cicatrices... si ayer fuera ma√±ana, ¬ød√≥nde quedar√≠a hoy atrapado?"' },
        { title: 'üåë Sala 7: La C√°mara del Eco', text: '"Ra√≠z que abraza la oscuridad... la luz ciega. Solo en la sombra aprendes a ver con el alma. Toca primero tu coraz√≥n, luego tu mente, y finalmente tus manos. As√≠ ver√°s lo que la luz esconde."' },
        { title: 'üö™ Sala 8: La Puerta Final', text: '"Bosque que conoce todos los ciclos... una puerta lleva al conocimiento. La otra, a la paz. Una pregunta. Una elecci√≥n."' },
        { title: '‚ú® El Regreso', text: '"Mira: vuelves a ser quien eras. Pero ahora no es inocencia ciega... es sabidur√≠a disfrazada de asombro. No envejecemos para llegar a ser viejos... envejecemos para recordar c√≥mo ser ni√±os con el alma intacta. La semilla que recuerda ser √°rbol... nunca muere. Solo espera el pr√≥ximo ciclo."' }
      ],
      puzzles: [
        { type: 'clipboard', answer: 'libertad' },
        { type: 'logic', answer: 'hijo' },
        { type: 'orientation', answer: 'complete' },
        { type: 'logic', answer: 'ayer' },
        { type: 'microphone', answer: 'blow' },
        { type: 'logic', answer: 'domingo' },
        { type: 'touch-sequence', answer: 'complete' },
        { type: 'logic', answer: 'guardian' }
      ]
    };

    const gameContainer = document.getElementById('game-container');
    const character = document.getElementById('character');
    const narrative = document.getElementById('narrative');
    const puzzleContainer = document.getElementById('puzzle-container');
    const progressBar = document.getElementById('progress-bar');
    updateProgressBar();

    // SALA 1: Mensaje oculto - SIN INSTRUCCIONES EXPL√çCITAS
    document.getElementById('submit-1').addEventListener('click', () => {
      const input = document.getElementById('clipboard-input').value.trim().toLowerCase();
      const feedback = document.getElementById('feedback-1');
      if (input === gameState.puzzles[0].answer) {
        feedback.innerHTML = '<div class="success">‚ú® El espejo se ilumina...</div>';
        setTimeout(() => advanceRoom(), 1200);
      } else {
        feedback.innerHTML = '<div class="error">‚ùå ¬øEs eso lo que realmente ves?</div>';
      }
    });

    // SALA 2: El Retrato
    function setupRoom2() {
      narrative.innerHTML = `<h2>${gameState.narratives[1].title}</h2><p><em>${gameState.narratives[1].text}</em></p>`;
      puzzleContainer.innerHTML = `
        <div class="puzzle-title">El Retrato Familiar</div>
        <p>"Hermanos y hermanas no tengo. Pero el padre de este hombre es hijo √∫nico de mi padre. ¬øQui√©n es el hombre del retrato?"</p>
        <input type="text" id="puzzle-2-input" placeholder="¬øQui√©n es?" autocomplete="off">
        <button id="submit-2">Responder</button>
        <div class="hint">
          <span class="hint-title">Reflexi√≥n:</span>
          El lazo m√°s fuerte no se rompe con el tiempo... solo con el olvido.
        </div>
        <div id="feedback-2"></div>
      `;
      document.getElementById('submit-2').addEventListener('click', () => {
        const input = document.getElementById('puzzle-2-input').value.trim().toLowerCase();
        const feedback = document.getElementById('feedback-2');
        if (input === 'hijo' || input === 'mi hijo' || input === 'el hijo') {
          feedback.innerHTML = '<div class="success">‚ú® El lazo eres t√∫ mismo...</div>';
          setTimeout(() => advanceRoom(), 1200);
        } else {
          feedback.innerHTML = '<div class="error">‚ùå Piensa en qui√©n nunca te abandona...</div>';
        }
      });
    }

    // SALA 3: Espejo Digital - CERO PISTAS, SIN FALLBACK
    function setupRoom3() {
      narrative.innerHTML = `<h2>${gameState.narratives[2].title}</h2><p><em>${gameState.narratives[2].text}</em></p>`;
      puzzleContainer.innerHTML = `
        <div class="puzzle-title">La Puerta Torcida</div>
        <div id="orientation-door">üö™</div>
        <p id="portrait-instruction">...</p>
        <p id="landscape-instruction" style="display:none;">
          <button id="solve-orientation">Atravesar</button>
        </p>
        <div id="feedback-3"></div>
      `;
      
      // SOLO se resuelve en landscape
      document.getElementById('solve-orientation')?.addEventListener('click', () => {
        if (window.matchMedia('(orientation: landscape)').matches) {
          document.getElementById('feedback-3').innerHTML = '<div class="success">‚ú® El mundo se endereza...</div>';
          gameState.solved[2] = true;
          setTimeout(() => advanceRoom(), 1200);
        } else {
          document.getElementById('feedback-3').innerHTML = '<div class="error">‚ùå La puerta sigue torcida...</div>';
        }
      });
    }

    // SALA 4: D√≠a Especial
    function setupRoom4() {
      narrative.innerHTML = `<h2>${gameState.narratives[3].title}</h2><p><em>${gameState.narratives[3].text}</em></p>`;
      puzzleContainer.innerHTML = `
        <div class="puzzle-title">El C√≠rculo del Tiempo</div>
        <p>"¬øQu√© d√≠a viene inmediatamente despu√©s del d√≠a que est√° antes de ayer?"</p>
        <input type="text" id="puzzle-4-input" placeholder="¬øQu√© d√≠a?" autocomplete="off">
        <button id="submit-4">Responder</button>
        <div class="hint">
          <span class="hint-title">Reflexi√≥n:</span>
          El tiempo no es una l√≠nea... es un c√≠rculo que siempre vuelve al mismo punto.
        </div>
        <div id="feedback-4"></div>
      `;
      document.getElementById('submit-4').addEventListener('click', () => {
        const input = document.getElementById('puzzle-4-input').value.trim().toLowerCase();
        const feedback = document.getElementById('feedback-4');
        if (input === 'ayer') {
          feedback.innerHTML = '<div class="success">‚ú® Siempre fue hoy...</div>';
          setTimeout(() => advanceRoom(), 1200);
        } else {
          feedback.innerHTML = '<div class="error">‚ùå Cuenta los d√≠as en silencio...</div>';
        }
      });
    }

    // SALA 5: Aliento - UMBRAL REDUCIDO A 50
    function setupRoom5() {
      narrative.innerHTML = `<h2>${gameState.narratives[4].title}</h2><p><em>${gameState.narratives[4].text}</em></p>`;
      puzzleContainer.innerHTML = `
        <div class="puzzle-title">El Valle Dormido</div>
        <p>El viento ha cesado. Solo tu aliento puede despertarlo.</p>
        <div id="mic-container">
          <button id="mic-btn">üå¨Ô∏è Soplar</button>
          <div id="mic-visualizer"></div>
        </div>
        <div class="hint">
          <span class="hint-title">Reflexi√≥n:</span>
          A veces basta un suspiro para cambiar el mundo.
        </div>
        <div id="feedback-5"></div>
      `;
      
      const visualizer = document.getElementById('mic-visualizer');
      for (let i = 0; i < 12; i++) {
        const bar = document.createElement('div');
        bar.className = 'mic-bar';
        visualizer.appendChild(bar);
      }
      
      let audioContext, analyser, dataArray;
      
      document.getElementById('mic-btn').addEventListener('click', async () => {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          analyser = audioContext.createAnalyser();
          const source = audioContext.createMediaStreamSource(stream);
          source.connect(analyser);
          
          analyser.fftSize = 256;
          const bufferLength = analyser.frequencyBinCount;
          dataArray = new Uint8Array(bufferLength);
          
          document.getElementById('mic-btn').disabled = true;
          document.getElementById('mic-btn').textContent = 'üí® Sopla suavemente...';
          
          const bars = document.querySelectorAll('.mic-bar');
          let blowDetected = false;
          
          function visualize() {
            analyser.getByteFrequencyData(dataArray);
            let sum = 0;
            for (let i = 0; i < bufferLength; i++) sum += dataArray[i];
            const average = sum / bufferLength;
            
            // ACTUALIZAR BARRAS
            for (let i = 0; i < bars.length; i++) {
              const height = (dataArray[i * 2] / 255) * 100;
              bars[i].style.height = `${Math.max(2, height)}px`; // M√≠nimo visible
            }
            
            // DETECTAR SOPLO SUAVE (UMBRAL 50)
            if (average > 50 && !blowDetected) {
              blowDetected = true;
              document.getElementById('feedback-5').innerHTML = '<div class="success">‚ú® El valle cobra vida...</div>';
              gameState.solved[4] = true;
              setTimeout(() => advanceRoom(), 1200);
            }
            
            if (!blowDetected) requestAnimationFrame(visualize);
          }
          
          visualize();
        } catch (err) {
          document.getElementById('feedback-5').innerHTML = '<div class="error">‚ùå El valle permanece en silencio...</div>';
          console.error(err);
          document.getElementById('mic-btn').disabled = false;
          document.getElementById('mic-btn').textContent = 'üå¨Ô∏è Soplar';
        }
      });
    }

    // SALA 6: Hilo del Tiempo
    function setupRoom6() {
      narrative.innerHTML = `<h2>${gameState.narratives[5].title}</h2><p><em>${gameState.narratives[5].text}</em></p>`;
      puzzleContainer.innerHTML = `
        <div class="puzzle-title">El Telar Roto</div>
        <p>"Si ayer fuera ma√±ana, hoy ser√≠a viernes. ¬øQu√© d√≠a es hoy realmente?"</p>
        <input type="text" id="puzzle-6-input" placeholder="¬øQu√© d√≠a?" autocomplete="off">
        <button id="submit-6">Responder</button>
        <div class="hint">
          <span class="hint-title">Reflexi√≥n:</span>
          Cuando el tiempo se enreda, busca el hilo que nunca se rompe: el presente.
        </div>
        <div id="feedback-6"></div>
      `;
      document.getElementById('submit-6').addEventListener('click', () => {
        const input = document.getElementById('puzzle-6-input').value.trim().toLowerCase();
        const feedback = document.getElementById('feedback-6');
        if (input === 'domingo' || input === 'dom') {
          feedback.innerHTML = '<div class="success">‚ú® Atrapado en el presente...</div>';
          setTimeout(() => advanceRoom(), 1200);
        } else {
          feedback.innerHTML = '<div class="error">‚ùå El telar sigue enredado...</div>';
        }
      });
    }

    // SALA 7: Toque de la Sombra
    function setupRoom7() {
      narrative.innerHTML = `<h2>${gameState.narratives[6].title}</h2><p><em>${gameState.narratives[6].text}</em></p>`;
      puzzleContainer.innerHTML = `
        <div class="puzzle-title">La Sombra Interior</div>
        <p>Toca en el orden correcto:</p>
        <div style="display:flex;justify-content:center;gap:15px;margin:25px 0;">
          <div class="touch-point" id="heart" style="width:60px;height:60px;font-size:28px;display:flex;align-items:center;justify-content:center;background:rgba(255,215,0,0.15);border-radius:50%;border:2px solid #ffd700;cursor:pointer;">‚ù§Ô∏è</div>
          <div class="touch-point" id="forehead" style="width:60px;height:60px;font-size:28px;display:flex;align-items:center;justify-content:center;background:rgba(255,215,0,0.15);border-radius:50%;border:2px solid #ffd700;cursor:pointer;">üí≠</div>
          <div class="touch-point" id="hands" style="width:60px;height:60px;font-size:28px;display:flex;align-items:center;justify-content:center;background:rgba(255,215,0,0.15);border-radius:50%;border:2px solid #ffd700;cursor:pointer;">‚úã</div>
        </div>
        <div class="hint">
          <span class="hint-title">Reflexi√≥n:</span>
          El camino hacia la luz comienza en la oscuridad... y en el orden correcto.
        </div>
        <div id="feedback-7"></div>
      `;
      
      const sequence = ['heart', 'forehead', 'hands'];
      let currentStep = 0;
      
      document.querySelectorAll('.touch-point').forEach(point => {
        point.addEventListener('click', () => {
          if (point.id === sequence[currentStep]) {
            point.style.background = 'rgba(0,255,157,0.3)';
            point.style.transform = 'scale(1.2)';
            currentStep++;
            if (currentStep === sequence.length) {
              document.getElementById('feedback-7').innerHTML = '<div class="success">‚ú® La oscuridad se disipa...</div>';
              gameState.solved[6] = true;
              setTimeout(() => advanceRoom(), 1200);
            }
          } else {
            document.querySelectorAll('.touch-point').forEach(p => {
              p.style.background = 'rgba(255,215,0,0.15)';
              p.style.transform = 'scale(1)';
            });
            currentStep = 0;
            document.getElementById('feedback-7').innerHTML = '<div class="error">‚ùå El orden es esencial...</div>';
          }
        });
      });
    }

    // SALA 8: Guardianes
    function setupRoom8() {
      narrative.innerHTML = `<h2>${gameState.narratives[7].title}</h2><p><em>${gameState.narratives[7].text}</em></p>`;
      puzzleContainer.innerHTML = `
        <div class="puzzle-title">La √öltima Pregunta</div>
        <p>"Dos puertas: vida o muerte. Dos guardianes: uno miente, otro dice la verdad. Una pregunta para saber el camino."</p>
        <textarea id="puzzle-8-input" placeholder="Escribe tu pregunta..." rows="3" autocomplete="off" style="margin:15px 0;"></textarea>
        <button id="submit-8">Preguntar</button>
        <div class="hint">
          <span class="hint-title">Reflexi√≥n:</span>
          La verdad y la mentira son dos caras de la misma moneda. Pregunta por la otra cara.
        </div>
        <div id="feedback-8"></div>
      `;
      
      document.getElementById('submit-8').addEventListener('click', () => {
        const input = document.getElementById('puzzle-8-input').value.toLowerCase();
        const feedback = document.getElementById('feedback-8');
        const hasOther = input.includes('otro') || input.includes('compa√±ero') || input.includes('guardian');
        const hasWouldSay = input.includes('dir√≠a') || input.includes('se√±alar√≠a') || input.includes('indicar√≠a');
        const hasDoor = input.includes('puerta') || input.includes('camino');
        
        if (hasOther && hasWouldSay && hasDoor) {
          feedback.innerHTML = '<div class="success">‚ú® Has recorrido toda la vida...</div>';
          setTimeout(() => showFinalScene(), 1500);
        } else {
          feedback.innerHTML = '<div class="error">‚ùå Los guardianes permanecen en silencio...</div>';
        }
      });
    }

    // ESCENA FINAL
    function showFinalScene() {
      gameState.currentRoom = 9;
      updateProgressBar();
      gameContainer.className = gameState.roomClasses[8];
      narrative.innerHTML = `<h2>${gameState.narratives[8].title}</h2><p><em>${gameState.narratives[8].text}</em></p>`;
      character.textContent = gameState.characterEmojis[7];
      character.className = gameState.characterClasses[7];
      
      puzzleContainer.innerHTML = `<div id="final-text"><p>----------</p></div>`;
      
      setTimeout(() => { character.style.opacity = '0.4'; character.style.transform = 'scale(1.4)'; }, 800);
      setTimeout(() => { character.textContent = '‚ú®'; character.style.fontSize = '90px'; }, 1600);
      setTimeout(() => {
        character.textContent = gameState.characterEmojis[8];
        character.className = gameState.characterClasses[8];
        character.style.cssText = 'font-size:64px;opacity:1;transform:scale(0.7);text-shadow:0 0 20px rgba(255,215,0,0.7);animation:pulse 3s infinite;';
        
        puzzleContainer.innerHTML = `
          <div id="final-text">
            <p><strong>"No envejecemos para llegar a ser viejos...</strong><br>
            <strong>envejecemos para recordar c√≥mo ser ni√±os</strong><br>
            <strong>con el alma intacta."</strong></p>
            <p style="margin-top:30px;font-size:18px;">----------</p>
            <p style="margin-top:20px;color:#00ff9d;">Gracias por recordar. üå±</p>
          </div>
          <button id="restart-btn" style="margin-top:30px;background:linear-gradient(135deg,#00ff9d 0%,#00d983 100%);">‚Ü∫ Comenzar de nuevo</button>
        `;
        document.getElementById('restart-btn').addEventListener('click', () => location.reload());
      }, 2800);
    }

    // AVANZAR SALA
    function advanceRoom() {
      gameState.solved[gameState.currentRoom - 1] = true;
      gameState.currentRoom++;
      gameState.characterStage++;
      updateProgressBar();
      
      character.textContent = gameState.characterEmojis[gameState.characterStage - 1];
      character.className = gameState.characterClasses[gameState.characterStage - 1];
      gameContainer.className = gameState.roomClasses[gameState.currentRoom - 1];
      
      narrative.innerHTML = `<h2>${gameState.narratives[gameState.currentRoom - 1].title}</h2><p><em>${gameState.narratives[gameState.currentRoom - 1].text}</em></p>`;
      
      switch(gameState.currentRoom) {
        case 2: setupRoom2(); break;
        case 3: setupRoom3(); break;
        case 4: setupRoom4(); break;
        case 5: setupRoom5(); break;
        case 6: setupRoom6(); break;
        case 7: setupRoom7(); break;
        case 8: setupRoom8(); break;
      }
    }

    function updateProgressBar() {
      progressBar.style.width = `${((gameState.currentRoom - 1) / 9) * 100}%`;
    }

    console.log('üéÆ El Ciclo del Aprendiz - Versi√≥n depurada');
  </script>
</body>
</html>
